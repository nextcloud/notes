!function(e,n,o,r,i){"use strict";var a=e.module("Notes",["restangular","ngRoute"]).config(["$provide","$routeProvider","RestangularProvider","$httpProvider","$windowProvider",function(e,t,n,r,i){r.defaults.headers.common.requesttoken=o,e.value("Constants",{saveInterval:5e3}),t.when("/notes/:noteId",{templateUrl:"note.html",controller:"NoteController",resolve:{note:["$route","$q","is","Restangular",function(e,t,n,o){var r=t.defer(),i=e.current.params.noteId;return n.loading=!0,o.one("notes",i).get().then(function(e){n.loading=!1,r.resolve(e)},function(){n.loading=!1,r.reject()}),r.promise}]}}).otherwise({redirectTo:"/"});var a=OC.generateUrl("/apps/notes");n.setBaseUrl(a)}]).run(["$rootScope","$location","NotesModel",function(e,t,o){n('link[rel="shortcut icon"]').attr("href",OC.filePath("notes","img","favicon.png")),e.$on("$routeChangeError",function(){var e=o.getAll();if(e.length>0){var n=e.sort(function(e,t){return e.modified>t.modified?1:e.modified<t.modified?-1:0}),r=e[n.length-1];t.path("/notes/"+r.id)}else t.path("/")})}]);a.controller("AppController",["$scope","$location","is",function(e,t,o){e.is=o,e.init=function(n,o,r){e.defaultTitle=document.title,0!==n&&""===t.path()&&t.path("/notes/"+n),o&&OC.Notification.showTemporary(o),r&&e.initSearch()},e.search="",e.defaultTitle=null,e.initSearch=function(){new OCA.Search(function(t){e.search=t,e.$apply(),"none"===n("#app-navigation-toggle").css("display")||n("body").hasClass("snapjs-left")||n("#app-navigation-toggle").click()},function(){e.search="",e.$apply()})}}]),a.controller("NoteController",["$routeParams","$scope","NotesModel","SaveQueue","note","debounce","$document","$timeout",function(e,o,r,i,a,c,u,l){r.updateIfExists(a),o.note=r.get(e.noteId),o.isSaving=function(){return i.isSaving()},o.isManualSaving=function(){return i.isManualSaving()},o.updateTitle=function(){var e=o.note.content;e=e.replace(/^\s*[*+-]\s+/gm,""),e=e.replace(/^#+\s+(.*?)\s*#*$/gm,"$1"),e=e.replace(/^(=+|-+)$/gm,""),e=e.replace(/(\*+|_+)(.*?)\1/gm,"$2"),e=e.replace(/[\*\|\/\\\:\"<>\?]/g,""),e=e.replace(/^[\. ]+/gm,""),o.note.title=e.trim().split(/\r?\n/,2)[0]||t("notes","New note")},o.onEdit=function(){var e=o.note;e.unsaved=!0,o.autoSave(e)},o.autoSave=c(function(e){i.add(e)},1e3),o.manualSave=function(){var e=o.note;e.error=!1,i.addManual(e)},o.editCategory=!1,o.showEditCategory=function(){n("#category").val(o.note.category),o.editCategory=!0,n("#category").autocomplete({source:r.getCategories(r.getAll(),0,!1),minLength:0,position:{my:"left bottom",at:"left top",of:"#category"},open:function(){l(function(){var e=n("form.category").innerWidth()-2;n(".ui-autocomplete.ui-menu").width(e)})}}).autocomplete("widget").addClass("category-autocomplete"),n("form.category .icon-confirm").insertAfter("#category"),l(function(){n("#category").focus(),n("#category").autocomplete("search","")})},o.saveCategory=function(){var e=n("#category").val();return o.note.category===e?void(o.editCategory=!1):(o.isCategorySaving=!0,void o.note.customPUT({category:e},"category",{},{}).then(function(n){o.note.category=n.category,e!==n.category&&OC.Notification.showTemporary(t("notes","Updating the note's category has failed. Is the target directory writable?"))},function(){OC.Notification.showTemporary(t("notes","Updating the note's category has failed."))})["finally"](function(){o.isCategorySaving=!1,o.editCategory=!1}))},u.unbind("keypress.notes.save"),u.bind("keypress.notes.save",function(e){if(e.ctrlKey||e.metaKey)switch(String.fromCharCode(e.which).toLowerCase()){case"s":e.preventDefault(),o.manualSave()}}),o.toggleDistractionFree=function(){function e(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function t(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?t():e(document.getElementById("app-content"))},o.$watch(function(){return o.note.title},function(e){e?document.title=e+" - "+o.defaultTitle:document.title=o.defaultTitle})}]),a.controller("NotesController",["$routeParams","$scope","$location","Restangular","NotesModel","$window",function(e,o,r,i,a,c){o.route=e,o.notesLoaded=!1,o.notes=a.getAll(),o.folderSelectorOpen=!1,o.filterCategory=null,o.orderRecent=["-favorite","-modified"],o.orderAlpha=["category","-favorite","title"],o.filterOrder=o.orderRecent;var u=i.all("notes");u.getList().then(function(e){a.addAll(e),o.notesLoaded=!0}),o.create=function(){u.post({category:o.filterCategory}).then(function(e){a.add(e),r.path("/notes/"+e.id)})},o["delete"]=function(e){var t=a.get(e);t.remove().then(function(){a.remove(e),o.$emit("$routeChangeError")})},o.toggleFavorite=function(e,t){var n=a.get(e);n.customPUT({favorite:!n.favorite},"favorite",{},{}).then(function(e){n.favorite=!!e}),t.target.blur()},o.categories=[],o.$watch("notes",function(e){o.categories=a.getCategories(e,1,!0)},!0),o.toggleFolderSelector=function(){o.folderSelectorOpen=!o.folderSelectorOpen},o.setFilter=function(e){null===e?o.filterOrder=o.orderRecent:o.filterOrder=o.orderAlpha,o.filterCategory=e,o.folderSelectorOpen=!1,n("#app-navigation > ul").animate({scrollTop:0},"fast")},o.categoryFilter=function(e){if(null!==o.filterCategory){if(e.category===o.filterCategory)return!0;if(null!==e.category)return e.category.startsWith(o.filterCategory+"/")}return!0},o.isCategory=function(e){return"string"==typeof e},c.onbeforeunload=function(){for(var e=a.getAll(),n=0;n<e.length;n+=1)if(e[n].unsaved)return t("notes","There are unsaved notes. Leaving the page will discard all changes!");return null}}]),a.controller("NotesSettingsController",["$scope","Restangular","$document",function(n,o,r){n.extensions=[".txt",".md"],o.one("settings").get().then(function(t){e.isObject(t)?n.settings=t:n.settings=o.one("settings")}),r.on("change","#notesPath",function(){var e=t("notes","Please wait while new settings are appliedâ€¦");OC.Notification.show(e),n.settings.put().then(function(){window.location.reload(!0)})}),r.on("change","#fileSuffix",function(){n.settings.put()})}]),a.filter("and",["$filter",function(e){return function(t,n){var o=n.split(" "),r=t;for(var i in o)r=e("filter")(r,o[i]);return r}}]),a.filter("categoryTitle",function(){return function(e){return e&&"string"==typeof e?e.replace(/\//g," / "):""}}),a.filter("groupNotes",function(){return function(e,t){if(t){for(var n=null,o=0;o<e.length;o+=1){var r=e[o];null!==n&&n!==r.category&&e.splice(o,0,r.category.substring(t.length+1)),n=r.category}return e}return e}}),a.filter("wordCount",function(){return function(e){if(e&&"string"==typeof e){var t=e.split(/\s+/).filter(function(e){return e.search(/[A-Za-z0-9]/)!==-1}).length;return window.n("notes","%n word","%n words",t)}return 0}}),a.directive("notesAutofocus",function(){return{restrict:"A",link:function(e,t){t.focus()}}}),a.directive("editor",["$timeout","urlFinder",function(t,o){return{restrict:"A",link:function(i,a){var c=new r({element:a[0],spellChecker:!1,autoDownloadFontAwesome:!1,toolbar:!1,status:!1,forceSync:!0}),u=n(c.codemirror.getWrapperElement());c.value(i.note.content),c.codemirror.focus(),c.codemirror.on("change",function(){t(function(){i.$apply(function(){i.note.content=c.value(),i.onEdit(),i.updateTitle()})})}),u.on("click",".cm-link, .cm-url",function(t){if(t.ctrlKey){var n=o(this);e.isDefined(n)&&window.open(n,"_blank")}})}}}]),a.directive("notesTooltip",function(){return{restrict:"A",link:function(e,t){t.tooltip({container:"body"}),t.on("$destroy",function(){t.tooltip("hide")}),t.on("click",function(){t.tooltip("hide")})}}}),a.factory("debounce",["$timeout",function(e){return function(t,n){var o;return function(){var r=this,i=arguments;o&&e.cancel(o),o=e(function(){t.apply(r,i)},n)}}}]),a.factory("is",function(){return{loading:!1}}),a.factory("NotesModel",function(){var t=function(){this.notes=[],this.notesIds={}};return t.prototype={addAll:function(e){for(var t=0;t<e.length;t+=1)this.add(e[t])},add:function(e){this.updateIfExists(e)},getAll:function(){return this.notes},get:function(e){return this.notesIds[e].error?(OC.Notification.show(this.notesIds[e].errorMessage,{type:"error"}),!1):this.notesIds[e]},updateIfExists:function(t){var n=this.notesIds[t.id];e.isDefined(n)?null===t.content&&null!==n.content||(n.title=t.title,n.modified=t.modified,n.content=t.content,n.favorite=t.favorite,n.category=t.category,n.error=t.error,n.errorMessage=t.errorMessage):(this.notes.push(t),this.notesIds[t.id]=t)},remove:function(e){for(var t=0;t<this.notes.length;t+=1){var n=this.notes[t];if(n.id===e){this.notes.splice(t,1),delete this.notesIds[e];break}}},nthIndexOf:function(e,t,n){for(var o=-1;n--&&o++<e.length&&(o=e.indexOf(t,o),!(o<0)););return o},getCategories:function(e,t,n){for(var o={},r=0;r<e.length;r+=1){var a=e[r].category;if(t>0){var c=this.nthIndexOf(a,"/",t);c>0&&(a=a.substring(0,c))}o[a]===i?o[a]=1:o[a]+=1}var u=[];for(var l in o)n?u.push({name:l,count:o[l]}):l&&u.push(l);return n||u.sort(),u}},new t}),a.factory("SaveQueue",["$q",function(e){var t=function(){this._queue={},this._flushLock=!1,this._manualSaveActive=!1};return t.prototype={add:function(e){this._queue[e.id]=e,this._flush()},addManual:function(e){this._manualSaveActive=!0,this.add(e)},_flush:function(){var t=Object.keys(this._queue);if(0!==t.length&&!this._flushLock){this._flushLock=!0;for(var n=this,o=[],r=0;r<t.length;r+=1){var i=this._queue[t[r]];o.push(i.put().then(this._noteUpdateRequest.bind(null,i))["catch"](this._saveFailed.bind(null,i)))}this._queue={},e.all(o).then(function(){n._flushLock=!1,n._flush(),n._manualSaveActive=!1})}},_noteUpdateRequest:function(e,t){e.error=!1,e.title=t.title,e.modified=t.modified,e.category=t.category,t.content===e.content&&(e.unsaved=!1)},_saveFailed:function(e){e.error=!0},isSaving:function(){return this._flushLock},isManualSaving:function(){return this._manualSaveActive}},new t}]),a.factory("urlFinder",[function(){return function(e){for(e=n(e),e.is(".cm-url.cm-formatting")&&0!==e.prev().length&&(e=e.prev());e.is(".cm-link");)e=e.next();for(;e.is(".cm-url.cm-formatting");)e=e.next();return e.is(".cm-url:not(.cm-formatting)")?e.text():i}}])}(angular,jQuery,oc_requesttoken,SimpleMDE);
//# sourceMappingURL=app.min.js.map
