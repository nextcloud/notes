!function(a,b,c,d,e,f){"use strict";var g=a.module("Notes",["restangular","ngRoute"]).config(["$provide","$routeProvider","RestangularProvider","$httpProvider","$windowProvider",function(a,b,d,e,f){e.defaults.headers.common.requesttoken=c,a.value("Constants",{saveInterval:5e3}),b.when("/notes/:noteId",{templateUrl:"note.html",controller:"NoteController",resolve:{note:["$route","$q","is","Restangular",function(a,b,c,d){var e=b.defer(),f=a.current.params.noteId;return c.loading=!0,d.one("notes",f).get().then(function(a){c.loading=!1,e.resolve(a)},function(){c.loading=!1,e.reject()}),e.promise}]}}).otherwise({redirectTo:"/"});var g=f.$get(),h=g.location.href,i=h.split("index.php")[0]+"index.php/apps/notes";d.setBaseUrl(i)}]).run(["$rootScope","$location","NotesModel",function(a,b,c){a.$on("$routeChangeError",function(){var a=c.getAll();if(a.length>0){var d=a.sort(function(a,b){return a.modified>b.modified?1:a.modified<b.modified?-1:0}),e=a[d.length-1];b.path("/notes/"+e.id)}else b.path("/")})}]);g.controller("AppController",["$scope","$location","is",function(a,b,c){a.is=c,a.init=function(a){0!==a&&b.path("/notes/"+a)}}]),g.controller("NoteController",["$routeParams","$scope","NotesModel","SaveQueue","note",function(a,b,c,d,e){c.updateIfExists(e),b.note=c.get(a.noteId),b.isSaving=function(){return d.isSaving()},b.updateTitle=function(){b.note.title=b.note.content.split("\n")[0]||t("notes","New note")},b.save=function(){var a=b.note;d.add(a)}}]),g.controller("NotesController",["$routeParams","$scope","$location","Restangular","NotesModel",function(a,b,c,d,e){b.route=a,b.notes=e.getAll();var f=d.all("notes");f.getList().then(function(a){e.addAll(a)}),b.create=function(){f.post().then(function(a){e.add(a),c.path("/notes/"+a.id)})},b["delete"]=function(a){var c=e.get(a);c.remove().then(function(){e.remove(a),b.$emit("$routeChangeError")})}}]),g.directive("notesAutofocus",function(){return{restrict:"A",link:function(a,b){b.focus()}}}),g.directive("editor",["$timeout",function(a){return{restrict:"A",link:function(b,c){var d=mdEdit(c[0],{change:function(c){a(function(){b.$apply(function(){b.note.content=c,b.updateTitle()})})}});d.setValue(b.note.content)}}}]),g.directive("notesIsSaving",["$window",function(a){return{restrict:"A",scope:{notesIsSaving:"="},link:function(b){a.onbeforeunload=function(){return b.notesIsSaving?t("notes","Note is currently saving. Leaving the page will delete all changes!"):null}}}}]),g.directive("markdown",function(){return d.setOptions({sanitize:!0,gfm:!0,tables:!0,breaks:!0,smartLists:!0,highlight:function(a){return e.highlightAuto(a).value}}),{restrict:"AE",link:function(a,b,c){if(c.markdown)a.$watch(c.markdown,function(a){var c=d(a);b.html(c)});else{var e=d(b.text());b.html(e)}}}}),g.directive("notesTimeoutChange",["$timeout",function(a){return{restrict:"A",link:function(c,d,e){var f,g=300;b(d).bind("input propertychange",function(){a.cancel(f),f=a(function(){c.$apply(e.notesTimeoutChange)},g)})}}}]),g.directive("notesTooltip",function(){return{restrict:"A",link:function(a,b){b.tooltip()}}}),g.filter("noteTitle",function(){return function(a){return a=a.split("\n")[0]||"newNote",a.trim().replace(/^#+/g,"")}}),g.factory("is",function(){return{loading:!1}}),g.factory("NotesModel",function(){var b=function(){this.notes=[],this.notesIds={}};return b.prototype={addAll:function(a){for(var b=0;b<a.length;b+=1)this.add(a[b])},add:function(a){this.updateIfExists(a)},getAll:function(){return this.notes},get:function(a){return this.notesIds[a]},updateIfExists:function(b){var c=this.notesIds[b.id];a.isDefined(c)?(c.title=b.title,c.modified=b.modified,c.content=b.content):(this.notes.push(b),this.notesIds[b.id]=b)},remove:function(a){for(var b=0;b<this.notes.length;b+=1){var c=this.notes[b];if(c.id===a){this.notes.splice(b,1),delete this.notesIds[a];break}}}},new b}),g.factory("SaveQueue",["$q",function(a){var b=function(){this._queue={},this._flushLock=!1};return b.prototype={add:function(a){this._queue[a.id]=a,this._flush()},_flush:function(){var b=Object.keys(this._queue);if(0!==b.length&&!this._flushLock){this._flushLock=!0;for(var c=this,d=[],e=0;e<b.length;e+=1){var f=this._queue[b[e]];d.push(f.put().then(this._noteUpdateRequest.bind(null,f)))}this._queue={},a.all(d).then(function(){c._flushLock=!1,c._flush()})}},_noteUpdateRequest:function(a,b){a.title=b.title,a.modified=b.modified},isSaving:function(){return this._flushLock}},new b}])}(angular,jQuery,oc_requesttoken,marked,hljs);
//# sourceMappingURL=app.min.js.map